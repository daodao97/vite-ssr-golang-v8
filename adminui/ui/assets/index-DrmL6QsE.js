const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GetRTAT-CBiVSwvb.js","assets/element-plus-Dafmimlt.js","assets/vue-B-SfU_kR.js","assets/crypto-js-Dyp0U-M-.js","assets/vue-runtime-dom-CeGziGLf.js","assets/vue-runtime-core-BdA0WvRm.js","assets/vue-reactivity-CXsOe-dj.js","assets/vue-shared-DfJbHraB.js","assets/vue-compiler-dom-CVS71qNH.js","assets/vue-compiler-core-DX1NfRgB.js","assets/lodash-es-CPGzQtoi.js","assets/vueuse-shared-ByQ8fdj-.js","assets/vueuse-core-BdHuZ0wz.js","assets/element-plus-icons-vue-D0EVbKiy.js","assets/sxzz-popperjs-es-DB1lLFnh.js","assets/ctrl-tinycolor-BuyEbX8F.js","assets/dayjs-hCpwiSkR.js","assets/async-validator-Cp9QasH9.js","assets/memoize-one-BdPwpGay.js","assets/normalize-wheel-es-BQoi3Ox2.js","assets/floating-ui-dom-BFdr95lq.js","assets/floating-ui-core-B_Ovcekz.js","assets/floating-ui-utils-dOBGhI8p.js","assets/element-plus-BwRSz-Nn.css","assets/vue-router-DXq6Y188.js","assets/okiss-oms-DFc_SLDJ.js","assets/okiss-utils-DLB9Z4qj.js","assets/handlebars-DuCeDWMH.js","assets/source-map-BSKk0CAR.js","assets/lodash-BU9I_SoQ.js","assets/pinia-CbWoapWl.js","assets/js-cookie-Cz0CWeBA.js","assets/mockjs-DoeQ1pEj.js","assets/axios-ngrFHoWO.js","assets/path-to-regexp-BqOC2I1t.js","assets/okiss-vbtf-C9fbskm7.js","assets/inputmask-Cg4EPAzv.js","assets/vuedraggable-Dyj1l8Pp.js","assets/sortablejs-BWyhpS7n.js","assets/file-saver-BLAVw3D0.js","assets/xlsx-BUrVjEmL.js","assets/okiss-vbtf-D5rTXQwG.css","assets/mitt-BUWluRzQ.js","assets/vue3-markdown-it-DVMXq1Os.js","assets/nprogress-BQSorFX4.js","assets/nprogress-BgDCIyLK.css","assets/okiss-oms-B1n66xOb.css","assets/normalize-Cg6lcjUC.css","assets/GetRTAT-DoCHoQQm.css","assets/RedeemCode-Ddx6D8Aa.js","assets/RedeemCode-ByoRilGX.css"])))=>i.map(i=>d[i]);
import"./vue-B-SfU_kR.js";import{b as tt,u as ht}from"./vue-router-DXq6Y188.js";import{N as $t,M as It,a as Pt,L as Ut,D as Ot}from"./okiss-oms-DFc_SLDJ.js";import{c as Ye,e as j,f as h,h as J,a as ge,o as at,v as e,k as l,j as R,q as G,l as ve,t as _,F as fe,J as he,R as lt}from"./vue-runtime-core-BdA0WvRm.js";import{t as w}from"./vue-shared-DfJbHraB.js";import{u as jt,r as Z,a as X}from"./vue-reactivity-CXsOe-dj.js";import{t as st,u as nt,G as it,w as ot,o as rt,n as dt,v as St,M as ut,a4 as kt,P as mt,_ as pt,Y as ct,D as ft,V as _t,C as gt,I as yt,T as Vt,a as C,X as Et,E as Ze,g as Dt,h as At,i as Rt,W as Lt,U as Mt,a5 as Bt,a6 as qt}from"./element-plus-Dafmimlt.js";import{w as bt,v as Ft}from"./vue-runtime-dom-CeGziGLf.js";import{Z as xt}from"./okiss-vbtf-C9fbskm7.js";import"./crypto-js-Dyp0U-M-.js";import"./vue-compiler-dom-CVS71qNH.js";import"./vue-compiler-core-DX1NfRgB.js";import"./okiss-utils-DLB9Z4qj.js";import"./handlebars-DuCeDWMH.js";import"./source-map-BSKk0CAR.js";import"./dayjs-hCpwiSkR.js";import"./lodash-BU9I_SoQ.js";import"./pinia-CbWoapWl.js";import"./js-cookie-Cz0CWeBA.js";import"./mockjs-DoeQ1pEj.js";import"./axios-ngrFHoWO.js";import"./path-to-regexp-BqOC2I1t.js";/* empty css                      */import"./mitt-BUWluRzQ.js";import"./element-plus-icons-vue-D0EVbKiy.js";import"./vueuse-core-BdHuZ0wz.js";import"./vueuse-shared-ByQ8fdj-.js";import"./vue3-markdown-it-DVMXq1Os.js";import"./nprogress-BQSorFX4.js";import"./lodash-es-CPGzQtoi.js";import"./sxzz-popperjs-es-DB1lLFnh.js";import"./ctrl-tinycolor-BuyEbX8F.js";import"./async-validator-Cp9QasH9.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-BQoi3Ox2.js";import"./floating-ui-dom-BFdr95lq.js";import"./floating-ui-core-B_Ovcekz.js";import"./floating-ui-utils-dOBGhI8p.js";import"./inputmask-Cg4EPAzv.js";import"./vuedraggable-Dyj1l8Pp.js";import"./sortablejs-BWyhpS7n.js";import"./file-saver-BLAVw3D0.js";import"./xlsx-BUrVjEmL.js";(function(){const W=document.createElement("link").relList;if(W&&W.supports&&W.supports("modulepreload"))return;for(const $ of document.querySelectorAll('link[rel="modulepreload"]'))g($);new MutationObserver($=>{for(const k of $)if(k.type==="childList")for(const D of k.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&g(D)}).observe(document,{childList:!0,subtree:!0});function M($){const k={};return $.integrity&&(k.integrity=$.integrity),$.referrerPolicy&&(k.referrerPolicy=$.referrerPolicy),$.crossOrigin==="use-credentials"?k.credentials="include":$.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function g($){if($.ep)return;$.ep=!0;const k=M($);fetch($.href,k)}})();const Jt="modulepreload",Qt=function(ie){return"/_/"+ie},wt={},Re=function(W,M,g){let $=Promise.resolve();if(M&&M.length>0){let B=function(N){return Promise.all(N.map(Y=>Promise.resolve(Y).then(oe=>({status:"fulfilled",value:oe}),oe=>({status:"rejected",reason:oe}))))};document.getElementsByTagName("link");const D=document.querySelector("meta[property=csp-nonce]"),U=D?.nonce||D?.getAttribute("nonce");$=B(M.map(N=>{if(N=Qt(N),N in wt)return;wt[N]=!0;const Y=N.endsWith(".css"),oe=Y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${N}"]${oe}`))return;const F=document.createElement("link");if(F.rel=Y?"stylesheet":Jt,Y||(F.as="script"),F.crossOrigin="",F.href=N,U&&F.setAttribute("nonce",U),document.head.appendChild(F),Y)return new Promise((x,P)=>{F.addEventListener("load",x),F.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${N}`)))})}))}function k(D){const U=new Event("vite:preloadError",{cancelable:!0});if(U.payload=D,window.dispatchEvent(U),!U.defaultPrevented)throw D}return $.then(D=>{for(const U of D||[])U.status==="rejected"&&k(U.reason);return W().catch(k)})},Xe=(ie,W)=>{const M=ie.__vccOpts||ie;for(const[g,$]of W)M[g]=$;return M},Gt={class:"dashboard-container"},Wt={class:"dashboard-text"},Yt={__name:"index",setup(ie){const W=$t(),M=Ye(()=>W.name),g=tt();return($,k)=>(h(),j("div",Gt,[J("div",Wt,"Hi "+w(M.value)+" "+w(jt(g).fullPath),1)]))}},Ht=Xe(Yt,[["__scopeId","data-v-f412afa0"]]),Nt=Object.freeze(Object.defineProperty({__proto__:null,default:Ht},Symbol.toStringTag,{value:"Module"})),Kt={class:"owner-maker-page"},Zt={class:"card-header"},Xt={class:"actions"},ea={class:"mail-fetch"},ta={class:"global-config",style:{margin:"12px 0"}},aa={class:"parse-actions"},la={style:{display:"flex",gap:"10px","align-items":"center","flex-wrap":"wrap"}},sa={class:"mono"},na={key:0,class:"mono"},ia={class:"mono"},oa={key:0,class:"mb8"},vt="owner_addrs_store",et="owner_addrs_selected",ra={__name:"Maker",setup(ie){const W=Z(""),M=Z([]),g=Z([]),$=Z(!1),k=X({total:0,ok:0,fail:0}),D=X({count:4,loading:!1}),U=X({group_id:"default"}),B=Z([]),N=()=>{const d=String(U.group_id||"").trim();for(const n of M.value)n.group_id=d},Y=d=>{const n=typeof d=="string"?d.trim():String(d??"").trim();n&&(B.value.includes(n)||(B.value=[...B.value,n].sort()))},oe=async()=>{try{const d=await fetch("/_api/team/group_ids");if(!d.ok)throw new Error(await d.text());const n=await d.json();if(typeof n.code<"u"&&n.code!==0)throw new Error(n.message||`业务错误(code=${n.code})`);const v=typeof n.code<"u"?n.data||{}:n,E=Array.isArray(v.group_ids)?v.group_ids:[],z=[];for(const O of E){if(typeof O!="string")continue;const A=O.trim();A&&(z.includes(A)||z.push(A))}z.sort(),B.value=z}catch{}finally{Y(U.group_id),M.value.forEach(d=>Y(d.group_id))}},F=async()=>{const d=Number(D.count||0);if(!Number.isFinite(d)||d<=0){C.error("请输入有效的领取数量");return}D.loading=!0;try{const n=new URLSearchParams({count:String(Math.min(Math.max(Math.floor(d),1),200))}),v=await fetch("/_api/team/mails/unused?"+n.toString());if(!v.ok)throw new Error(await v.text());const E=await v.json();if(typeof E.code<"u"&&E.code!==0)throw new Error(E.message||`业务错误(code=${E.code})`);const z=typeof E.code<"u"?E.data||{}:E,O=Array.isArray(z.items)?z.items:[];if(!O.length){W.value="",M.value=[],g.value=[],Object.assign(k,{total:0,ok:0,fail:0}),C.warning("未获取到可用账号");return}const A=String(U.group_id||"").trim();M.value=O.map(K=>({email:K.mail||"",gpt_pwd:K.gpt_pwd||"",mail_pwd:K.mail_pwd||"",rt:K.rt||"",workspace:ye(),seats:7,group_id:A,__busy:!1,__step:"",__teamId:void 0,__payUrl:"",__autoPayStatus:""})),g.value=[],k.total=O.length,k.ok=O.length,k.fail=0,Y(A),de()}catch(n){C.error(String(n))}finally{D.loading=!1}},x=Z(""),P=Z([]),Q=Z([]),H=X({count:0,uses:0}),S=Z([]),V=Z(null),te=X({visible:!1,editingId:null}),q=X({full_name:"",address_line1:"",address_line2:"",city:"",state:"",zip_code:"",country:""});let xe=null,Ne=null;ge(W,()=>{clearTimeout(xe),xe=setTimeout(()=>{Ce(),de()},300)}),ge(x,()=>{clearTimeout(Ne),Ne=setTimeout(()=>{ze(),de()},300)}),ge(()=>U.group_id,d=>{N(),Y(d)});const Te=()=>{W.value="",M.value=[],g.value=[],Object.assign(k,{total:0,ok:0,fail:0}),x.value="",P.value=[],Q.value=[],Object.assign(H,{count:0,uses:0})},Se=/^[^@\s]+@[^@\s]+\.[^@\s]+$/,_e=/-{3,}/,ye=()=>"ChatGPT Business Workspace",Pe=d=>{if(!d)return"";const n=String(d);return n.length<=28?n:n.slice(0,16)+"…"+n.slice(-8)},Ce=()=>{const d=String(W.value||"").split(/\r?\n/),n=[],v=[];let E=0;for(const z of d){E++;const O=String(z||"").trim();if(!O)continue;const A=O.split(_e).map(b=>b.trim()).filter(Boolean);if(A.length<4){v.push({lineNo:E,raw:O,reason:"分隔符格式错误或字段不足"});continue}const[K,ne,i,s,...u]=A;if(!Se.test(K)){v.push({lineNo:E,raw:O,reason:"邮箱格式错误"});continue}if(!s||!s.startsWith("rt_")||!s.startsWith("xy")){v.push({lineNo:E,raw:O,reason:"RT 缺失或格式不对"});continue}const m={email:K,gpt_pwd:ne||"",mail_pwd:i||"",rt:[s,...u].filter(Boolean).join("---"),workspace:ye(),seats:7,group_id:String(U.group_id||"").trim(),__busy:!1,__step:"",__teamId:void 0,__payUrl:"",__autoPayStatus:""};n.push(m)}M.value=n,N(),M.value.forEach(z=>Y(z.group_id)),g.value=v,k.total=d.filter(z=>String(z).trim()).length,k.ok=n.length,k.fail=v.length,de()},Le=d=>{if(!d)return"";const n=String(d).replace(/[^0-9]/g,"");return n.length===4?n.slice(0,2)+"/"+n.slice(2):n.length===6?n.slice(0,2)+"/"+n.slice(4):(/^\d{2}\/\d{2}$/.test(d),d)},ze=()=>{const d=String(x.value||"").split(/\r?\n/),n=[],v=[];let E=0;for(const z of d){E++;const O=String(z||"").trim();if(!O)continue;const A=O.split(/\s+/).filter(Boolean);if(A.length<3){v.push({lineNo:E,raw:O,reason:"格式需：卡号 MMYY CVV"});continue}const[K,ne,i]=A,s=(K||"").replace(/\D/g,"");if(s.length<12){v.push({lineNo:E,raw:O,reason:"卡号无效"});continue}const u=Le(ne);if(!/^\d{2}\/\d{2}$/.test(u)){v.push({lineNo:E,raw:O,reason:"有效期无效"});continue}if(!/^\d{3,4}$/.test(String(i||""))){v.push({lineNo:E,raw:O,reason:"CVV无效"});continue}n.push({number:s,last4:s.slice(-4),expiry:u,cvc:String(i),uses:0})}P.value=n,Q.value=v,H.count=n.length,H.uses=n.length*2,de()},de=()=>{const d=[];for(const v of P.value)d.push(v),d.push(v);let n=0;for(const v of M.value)if(n<d.length){const E=d[n++];v.__card={last4:E.last4,expiry:E.expiry,cvc:E.cvc,number:E.number}}else v.__card=null},Ue=d=>`${d.full_name||""} — ${d.city||""} ${d.state||""} ${d.zip_code||""}`.trim(),ue=()=>{try{S.value=JSON.parse(localStorage.getItem(vt)||"[]")}catch{S.value=[]}const d=localStorage.getItem(et);V.value=d||null},pe=()=>{try{localStorage.setItem(vt,JSON.stringify(S.value||[]))}catch{}};ge(V,d=>{try{d?localStorage.setItem(et,String(d)):localStorage.removeItem(et)}catch{}}),ue();const re=()=>{te.editingId=null,Object.assign(q,{full_name:"",address_line1:"",address_line2:"",city:"",state:"",zip_code:"",country:""}),te.visible=!0},Oe=()=>{te.visible=!0,te.editingId||(te.editingId=null)},Me=d=>{te.editingId=d.id,Object.assign(q,{...d}),te.visible=!0},Be=d=>{const n=S.value.findIndex(v=>String(v.id)===String(d.id));n>=0&&(S.value.splice(n,1),String(V.value)===String(d.id)&&(V.value=null),pe())},qe=()=>{const d={full_name:q.full_name?.trim(),address_line1:q.address_line1?.trim(),address_line2:q.address_line2?.trim(),city:q.city?.trim(),state:q.state?.trim(),zip_code:q.zip_code?.trim(),country:q.country?.trim()};if(!d.full_name||!d.address_line1||!d.city||!d.state||!d.zip_code||!d.country){C.error("请完整填写必填项（姓名/地址1/城市/州/邮编/国家）");return}if(te.editingId){const n=S.value.findIndex(v=>String(v.id)===String(te.editingId));n>=0&&(S.value[n]={...S.value[n],...d})}else{const n=Date.now().toString(36)+Math.random().toString(36).slice(2,8);S.value.push({id:n,...d}),V.value=n}pe(),te.visible=!1},$e=()=>{const d=V.value;return d&&S.value.find(n=>String(n.id)===String(d))||null},Fe=()=>{Ce(),ze(),de()},Je=async d=>{if(!(!d||d.__busy)){d.__busy=!0,d.__step="create";try{const n={email:d.email,password:d.gpt_pwd,seats:Number(d.seats)||7,status:-1,rt:d.rt},v=String(d.group_id??"").trim();if(v&&(n.group_id=v),!n.email||!n.password||!n.rt)throw new Error("email/password/rt 不能为空");const E=await fetch("/_api/team",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!E.ok){const A=await E.text();let K=A;try{K=JSON.parse(A).message||A}catch{}if(E.status===409||/账号已存在/.test(String(K))||/409/.test(String(K))){await ce(d);return}throw new Error(K)}const z=await E.json();if(typeof z.code<"u"&&z.code!==0)throw new Error(z.message||`业务错误(code=${z.code})`);const O=typeof z.code<"u"?z.data||{}:z;d.__teamId=O.id,C.success(`团队已创建(ID=${d.__teamId||"?"})`)}catch(n){C.error(String(n))}finally{d.__busy=!1,d.__step=""}}},ce=async d=>{const n=new URLSearchParams({email:d.email}),v=await fetch("/_api/teams?"+n.toString());if(!v.ok)throw new Error(await v.text());const E=await v.json();if(typeof E.code<"u"&&E.code!==0)throw new Error(E.message||`业务错误(code=${E.code})`);const O=((typeof E.code<"u"?E.data?.list||[]:E.list||[])||[]).find(K=>String(K.email||"").toLowerCase()===String(d.email||"").toLowerCase());if(!O)throw new Error("账号已存在，但无法获取团队信息");if(Number(O.status)!==-1)throw new Error("账号已存在且非待支付状态，无法生成支付链接");d.__teamId=O.id,C.success(`已关联已存在团队(ID=${d.__teamId})`)},be=async d=>{if(!(!d||d.__busy)){if(!d.__teamId){C.error("请先创建团队");return}d.__busy=!0,d.__step="pay_manual";try{const n={team_id:d.__teamId,workspace_name:d.workspace||ye(),seat_quantity:5,autopay:!1},v=await fetch("/_api/team/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!v.ok)throw new Error(await v.text());const E=await v.json();if(typeof E.code<"u"&&E.code!==0)throw new Error(E.message||`业务错误(code=${E.code})`);const z=typeof E.code<"u"?E.data||{}:E;if(d.__payUrl=z.url||"",!d.__payUrl)throw new Error("生成支付链接失败");ke(d.__payUrl,d.__teamId)}catch(n){C.error(String(n))}finally{d.__busy=!1,d.__step=""}}};at(()=>{oe()});const me=async d=>{if(!d||d.__busy)return;if(!d.__teamId){C.error("请先创建团队");return}if(!d.__card){C.error("无可用卡，无法自动支付");return}d.__autoPayStatus="",d.__busy=!0,d.__step="pay_auto";let n="retry";try{const v={team_id:d.__teamId,workspace_name:d.workspace||ye(),seat_quantity:5,autopay:!0,payment_info:{card_number:d.__card.number,expiry_date:d.__card.expiry,cvc:d.__card.cvc},address_info:$e()||void 0},E=await fetch("/_api/team/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!E.ok)throw new Error(await E.text());const z=await E.json();if(typeof z.code<"u"&&z.code!==0)throw new Error(z.message||`业务错误(code=${z.code})`);const O=typeof z.code<"u"?z.data||{}:z;O.paid?(C.success("已自动支付完成"),n="success"):O.url?(d.__payUrl=O.url,ke(d.__payUrl,d.__teamId)):C.success("已生成支付请求")}catch(v){C.error(String(v))}finally{d.__busy=!1,d.__step="",d.__autoPayStatus=n}},ee=X({visible:!1,url:"",teamId:void 0}),ke=(d,n)=>{ee.url=d||"",ee.teamId=n,ee.visible=!!ee.url},Ie=async()=>{try{await navigator.clipboard.writeText(ee.url),C.success("已复制")}catch{}},je=()=>{try{window.open(ee.url,"_blank")}catch{}},De=async()=>{if(ee.teamId)try{const d=await fetch("/_api/team",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:ee.teamId,status:1})});if(!d.ok)throw new Error(await d.text());const n=await d.json();if(typeof n.code<"u"&&n.code!==0)throw new Error(n.message||"标记失败");C.success("已标记为已支付（状态=1）"),ee.visible=!1}catch(d){C.error(String(d))}};return(d,n)=>{const v=ot,E=it,z=nt,O=st,A=dt,K=rt,ne=St,i=ut,s=mt,u=kt,m=ct,b=pt,a=ft,t=gt,c=yt,f=Vt,p=_t;return h(),j(fe,null,[J("div",Kt,[e(t,{shadow:"never"},{header:l(()=>[J("div",Zt,[n[20]||(n[20]=_(" 团队母号构建器 ",-1)),J("div",Xt,[e(v,{size:"small",onClick:Te},{default:l(()=>[...n[17]||(n[17]=[_("清空",-1)])]),_:1}),e(v,{size:"small",onClick:Fe},{default:l(()=>[...n[18]||(n[18]=[_("一键解析",-1)])]),_:1}),e(v,{type:"primary",size:"small",onClick:Ce},{default:l(()=>[...n[19]||(n[19]=[_("解析",-1)])]),_:1})])])]),default:l(()=>[J("div",ea,[n[22]||(n[22]=J("div",{class:"tips"},"从邮箱池领取账号（自动过滤已使用记录）",-1)),e(O,{inline:!0,size:"small",class:"mail-fetch-form",onSubmit:n[1]||(n[1]=bt(()=>{},["prevent"]))},{default:l(()=>[e(z,{label:"领取数量"},{default:l(()=>[e(E,{modelValue:D.count,"onUpdate:modelValue":n[0]||(n[0]=r=>D.count=r),min:1,max:200},null,8,["modelValue"])]),_:1}),e(z,null,{default:l(()=>[e(v,{type:"primary",loading:D.loading,onClick:F},{default:l(()=>[...n[21]||(n[21]=[_("获取账号",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),J("div",ta,[e(O,{inline:!0,size:"small"},{default:l(()=>[e(z,{label:"分组ID"},{default:l(()=>[e(K,{modelValue:U.group_id,"onUpdate:modelValue":n[2]||(n[2]=r=>U.group_id=r),clearable:"",filterable:"","allow-create":"",placeholder:"可选，变更后自动应用",style:{"min-width":"200px"}},{default:l(()=>[(h(!0),j(fe,null,he(B.value,r=>(h(),R(A,{key:r,label:r,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),e(ne),n[30]||(n[30]=J("div",{class:"tips"},"付款卡信息（每行：卡号 空格 MMYY 空格 CVV；每张卡限用两次）",-1)),e(i,{modelValue:x.value,"onUpdate:modelValue":n[3]||(n[3]=r=>x.value=r),type:"textarea",rows:5,placeholder:"例如：\\n4549240600775409 0130 193\\n4549240600774881 0629 008"},null,8,["modelValue"]),J("div",aa,[e(u,null,{default:l(()=>[e(s,null,{default:l(()=>[_("卡片数："+w(H.count),1)]),_:1}),e(s,{type:"info"},{default:l(()=>[_("可用次数："+w(H.uses),1)]),_:1}),Q.value.length?(h(),R(s,{key:0,type:"warning"},{default:l(()=>[_("无效："+w(Q.value.length),1)]),_:1})):G("",!0),e(v,{size:"small",onClick:ze},{default:l(()=>[...n[23]||(n[23]=[_("解析卡信息",-1)])]),_:1}),e(v,{size:"small",onClick:de},{default:l(()=>[...n[24]||(n[24]=[_("重新分配",-1)])]),_:1})]),_:1})]),Q.value.length?(h(),R(b,{key:0,data:Q.value,size:"small",border:!0,class:"mt8"},{default:l(()=>[e(m,{prop:"lineNo",label:"#",width:"70"}),e(m,{prop:"raw",label:"原始文本"}),e(m,{prop:"reason",label:"原因",width:"180"})]),_:1},8,["data"])):G("",!0),e(ne),n[31]||(n[31]=J("div",{class:"tips"},"地址信息（表单管理，支持多个，保存在浏览器，仅用于自动支付）",-1)),J("div",la,[e(K,{modelValue:V.value,"onUpdate:modelValue":n[4]||(n[4]=r=>V.value=r),clearable:"",filterable:"",placeholder:"未选择时使用默认地址",style:{"min-width":"320px"}},{default:l(()=>[(h(!0),j(fe,null,he(S.value,r=>(h(),R(A,{key:r.id,label:Ue(r),value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(v,{size:"small",onClick:re},{default:l(()=>[...n[25]||(n[25]=[_("新增地址",-1)])]),_:1}),e(v,{size:"small",onClick:Oe,disabled:S.value.length===0},{default:l(()=>[...n[26]||(n[26]=[_("管理地址",-1)])]),_:1},8,["disabled"])]),g.value.length?(h(),R(a,{key:1,title:"以下行解析失败（已忽略）：",type:"warning","show-icon":"",closable:!1})):G("",!0),g.value.length?(h(),R(b,{key:2,data:g.value,size:"small",border:!0,class:"mt8"},{default:l(()=>[e(m,{prop:"lineNo",label:"#",width:"70"}),e(m,{prop:"raw",label:"原始文本"}),e(m,{prop:"reason",label:"原因",width:"180"})]),_:1},8,["data"])):G("",!0),e(ne),ve((h(),R(b,{data:M.value,size:"small",border:!0},{default:l(()=>[e(m,{type:"index",width:"60",label:"#"}),e(m,{prop:"email",label:"邮箱","min-width":"200"}),e(m,{prop:"gpt_pwd",label:"GPT 密码","min-width":"160"}),e(m,{prop:"mail_pwd",label:"邮箱密码","min-width":"160"}),e(m,{prop:"rt",label:"RT","min-width":"320"},{default:l(({row:r})=>[J("span",sa,w(Pe(r.rt)),1)]),_:1}),e(m,{label:"支付卡","min-width":"220"},{default:l(({row:r})=>[r.__card?(h(),j("span",na,"**** **** **** "+w(r.__card.last4)+"｜"+w(r.__card.expiry),1)):(h(),R(s,{key:1,type:"danger"},{default:l(()=>[...n[27]||(n[27]=[_("无可用卡",-1)])]),_:1}))]),_:1}),e(m,{label:"Workspace 名称","min-width":"160"},{default:l(({row:r})=>[e(i,{modelValue:r.workspace,"onUpdate:modelValue":I=>r.workspace=I,placeholder:"默认 ChatGPT Business Workspace"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(m,{label:"分组ID",width:"160"},{default:l(({row:r})=>[J("span",ia,w(r.group_id||"—"),1)]),_:1}),e(m,{label:"席位",width:"120"},{default:l(({row:r})=>[e(E,{modelValue:r.seats,"onUpdate:modelValue":I=>r.seats=I,min:1},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(m,{label:"操作",width:"340",fixed:"right"},{default:l(({row:r,$index:I})=>[e(v,{type:"primary",link:"",size:"small",loading:r.__busy&&r.__step==="create",onClick:L=>Je(r)},{default:l(()=>[...n[28]||(n[28]=[_("创建团队",-1)])]),_:1},8,["loading","onClick"]),e(ne,{direction:"vertical"}),e(v,{link:"",size:"small",disabled:!r.__teamId,loading:r.__busy&&r.__step==="pay_auto",onClick:L=>me(r)},{default:l(()=>[_(w(r.__autoPayStatus==="success"?"成功":r.__autoPayStatus==="retry"?"重试":"自动支付"),1)]),_:2},1032,["disabled","loading","onClick"]),e(ne,{direction:"vertical"}),e(v,{link:"",size:"small",disabled:!r.__teamId,loading:r.__busy&&r.__step==="pay_manual",onClick:L=>be(r)},{default:l(()=>[...n[29]||(n[29]=[_("手动支付",-1)])]),_:1},8,["disabled","loading","onClick"])]),_:1})]),_:1},8,["data"])),[[p,$.value]])]),_:1})]),e(c,{modelValue:ee.visible,"onUpdate:modelValue":n[7]||(n[7]=r=>ee.visible=r),title:"支付链接",width:"640px"},{footer:l(()=>[e(v,{onClick:n[6]||(n[6]=r=>ee.visible=!1)},{default:l(()=>[...n[32]||(n[32]=[_("关闭",-1)])]),_:1}),e(v,{onClick:Ie},{default:l(()=>[...n[33]||(n[33]=[_("复制",-1)])]),_:1}),e(v,{onClick:De,disabled:!ee.teamId},{default:l(()=>[...n[34]||(n[34]=[_("已完成支付",-1)])]),_:1},8,["disabled"]),e(v,{type:"primary",onClick:je},{default:l(()=>[...n[35]||(n[35]=[_("打开",-1)])]),_:1})]),default:l(()=>[e(a,{title:"请使用下方链接完成支付",type:"info","show-icon":"",closable:!1,class:"mb8"}),e(i,{modelValue:ee.url,"onUpdate:modelValue":n[5]||(n[5]=r=>ee.url=r),readonly:"",type:"textarea",rows:3},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(c,{modelValue:te.visible,"onUpdate:modelValue":n[16]||(n[16]=r=>te.visible=r),title:te.editingId?"编辑地址":"新增地址",width:"720px"},{footer:l(()=>[e(v,{onClick:n[15]||(n[15]=r=>te.visible=!1)},{default:l(()=>[...n[38]||(n[38]=[_("取消",-1)])]),_:1}),e(v,{type:"primary",onClick:qe},{default:l(()=>[...n[39]||(n[39]=[_("保存",-1)])]),_:1})]),default:l(()=>[S.value.length?(h(),j("div",oa,[e(b,{data:S.value,size:"small",border:!0},{default:l(()=>[e(m,{label:"姓名",width:"140"},{default:l(({row:r})=>[_(w(r.full_name),1)]),_:1}),e(m,{label:"地址","min-width":"260"},{default:l(({row:r})=>[_(w(r.address_line1)+" "+w(r.address_line2),1)]),_:1}),e(m,{label:"地区",width:"200"},{default:l(({row:r})=>[_(w(r.city)+", "+w(r.state)+" "+w(r.zip_code)+" ("+w(r.country)+")",1)]),_:1}),e(m,{label:"操作",width:"160"},{default:l(({row:r})=>[e(v,{link:"",size:"small",onClick:I=>Me(r)},{default:l(()=>[...n[36]||(n[36]=[_("编辑",-1)])]),_:1},8,["onClick"]),e(ne,{direction:"vertical"}),e(f,{title:"确定删除该地址？",onConfirm:()=>Be(r)},{reference:l(()=>[e(v,{link:"",size:"small",type:"danger"},{default:l(()=>[...n[37]||(n[37]=[_("删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:1})]),_:1},8,["data"])])):G("",!0),e(O,{model:q,"label-width":"120px"},{default:l(()=>[e(z,{label:"姓名"},{default:l(()=>[e(i,{modelValue:q.full_name,"onUpdate:modelValue":n[8]||(n[8]=r=>q.full_name=r)},null,8,["modelValue"])]),_:1}),e(z,{label:"地址1"},{default:l(()=>[e(i,{modelValue:q.address_line1,"onUpdate:modelValue":n[9]||(n[9]=r=>q.address_line1=r)},null,8,["modelValue"])]),_:1}),e(z,{label:"地址2"},{default:l(()=>[e(i,{modelValue:q.address_line2,"onUpdate:modelValue":n[10]||(n[10]=r=>q.address_line2=r)},null,8,["modelValue"])]),_:1}),e(z,{label:"城市"},{default:l(()=>[e(i,{modelValue:q.city,"onUpdate:modelValue":n[11]||(n[11]=r=>q.city=r)},null,8,["modelValue"])]),_:1}),e(z,{label:"州/省"},{default:l(()=>[e(i,{modelValue:q.state,"onUpdate:modelValue":n[12]||(n[12]=r=>q.state=r)},null,8,["modelValue"])]),_:1}),e(z,{label:"邮编"},{default:l(()=>[e(i,{modelValue:q.zip_code,"onUpdate:modelValue":n[13]||(n[13]=r=>q.zip_code=r)},null,8,["modelValue"])]),_:1}),e(z,{label:"国家"},{default:l(()=>[e(i,{modelValue:q.country,"onUpdate:modelValue":n[14]||(n[14]=r=>q.country=r)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}},da=Xe(ra,[["__scopeId","data-v-7a2fb51e"]]),Tt=Object.freeze(Object.defineProperty({__proto__:null,default:da},Symbol.toStringTag,{value:"Module"})),ua={class:"team-member-page"},ma={class:"card-header"},pa={class:"actions"},ca={class:"table-pagination"},fa={class:"fetch-actions"},_a={key:0},ga={key:0},ya={key:1},ba={key:2},wa={key:3},va={key:1},ha={key:2},Sa={key:3},ka={key:0,class:"export-box"},Va={class:"parse-actions"},Ea={key:0},xa={key:0},Na={key:1},Ta={key:2},Ca={key:3},za={key:1},$a={key:2},Ia={key:3},Pa={__name:"Member",setup(ie){const W=Z(!1),M=Z(!1),g=X({team_id:void 0,email:"",status:null}),$=Z(!1),k=X({page:1,pageSize:20,total:0}),D=Z([]),U=Z([]),B=Z(!1),N=Z([]),Y=tt(),oe=ht(),F=X({visible:!1,isEdit:!1}),x=X({id:void 0,team_id:void 0,email:"",uid:"",status:2,plan:""}),P=/-{3,}/,Q=/^[^@\s]+@[^@\s]+\.[^@\s]+$/,H=a=>String(a??"").trim(),S=X({visible:!1,team_id:void 0,raw:"",rows:[],failures:[],stats:{total:0,ok:0,fail:0},busy:!1}),V=X({visible:!1,count:1,group_id:"",team_id:void 0,busy:!1,results:[]}),te=Ye(()=>S.rows.some(a=>a.status==="pending")),q=Ye(()=>V.results.reduce((a,t)=>a+(t?.status==="success"?1:0),0)),xe=Ye(()=>V.results.reduce((a,t)=>a+(t?.status==="error"?1:0),0)),Ne=Ye(()=>{const a=[];for(const t of V.results){if(!t||t.status!=="success")continue;const c=H(t.email||t.response?.mail||t.response?.email||""),f=H(t.gpt_pwd||t.response?.gpt_pwd),p=H(t.mail_pwd||t.response?.mail_pwd),r=H(t.rt||t.response?.rt);a.push(`${c}---${f}---${p}---${r}`)}return a.length?a.join(`
`):""}),Te=["team_id","email","group_id","status","queried"];let Se=!1;const _e=a=>Array.isArray(a)?a[a.length-1]:a,ye=a=>{const t=_e(a);if(t==null||t==="")return;const c=Number(t);return Number.isFinite(c)?c:void 0},Pe=a=>{const t=_e(a);if(t==null||t==="")return null;const c=Number(t);return Number.isFinite(c)?c:null},Ce=a=>{const t=_e(a);return typeof t=="string"?t:""},Le=a=>{const t=_e(a);if(typeof t!="string")return null;const c=t.trim();return c||null},ze=a=>_e(a)==="1",de=a=>{const t={};for(const c of Te){const f=a[c];if(Array.isArray(f)){if(!f.length)continue;const p=f[f.length-1];if(p==null||p==="")continue;t[c]=p;continue}f==null||f===""||(t[c]=f)}return t},Ue=(a,t)=>{const c=Object.entries(a).sort((p,r)=>p[0].localeCompare(r[0])),f=Object.entries(t).sort((p,r)=>p[0].localeCompare(r[0]));if(c.length!==f.length)return!1;for(let p=0;p<c.length;p++)if(c[p][0]!==f[p][0]||c[p][1]!==f[p][1])return!1;return!0},ue=()=>{const a={};g.team_id!==void 0&&g.team_id!==null&&g.team_id!==""&&(a.team_id=String(g.team_id)),g.email&&(a.email=g.email);const t=typeof g.group_id=="string"?g.group_id.trim():"";return t&&(a.group_id=t),g.status!==null&&g.status!==void 0&&g.status!==""&&(a.status=String(g.status)),$.value&&(a.queried="1"),a},pe=async()=>{const a=ue(),t=de(Y.query);if(Ue(t,a))return;const c={};for(const[f,p]of Object.entries(Y.query))Te.includes(f)||(c[f]=p);Se=!0;try{await oe.replace({query:{...c,...a}})}finally{Se=!1}},re=async(a,{triggerLoad:t=!1}={})=>{const c=ye(a.team_id),f=Ce(a.email),p=Le(a.group_id),r=Pe(a.status),L=ze(a.queried)||c!==void 0||!!f||p!==null||r!==null;if(g.team_id!==c&&(g.team_id=c),g.email!==f&&(g.email=f),g.group_id!==p&&(g.group_id=p),g.status!==r&&(g.status=r),$.value=L,!L){t&&(D.value=[],k.total=0,k.page=1);return}t&&(k.page=1,await A(!0))},Oe=()=>{g.team_id=void 0,g.email="",g.group_id=null,g.status=null},Me=async()=>{$.value=!0,k.page=1,await A(!0)},Be=async()=>{Oe(),k.page=1,$.value=!1,D.value=[],k.total=0,await pe()},qe=a=>{$.value&&(k.page=a,A())},$e=a=>{$.value&&(k.pageSize=a,k.page=1,A())},Fe=()=>{S.visible=!0,S.team_id=g.team_id||void 0},Je=()=>{V.visible=!0,V.count=1,V.results=[],V.team_id=g.team_id||S.team_id||void 0;const a=String(g.group_id||"").trim();a?(V.group_id=a,ce(a)):V.group_id=""},ce=a=>{const t=typeof a=="string"?a.trim():String(a??"").trim();t&&(N.value.includes(t)||(N.value=[...N.value,t].sort()))},be=async()=>{try{const a=await fetch("/_api/team/group_ids");if(!a.ok)throw new Error(await a.text());const t=await a.json();if(typeof t.code<"u"&&t.code!==0)throw new Error(t.message||`业务错误(code=${t.code})`);const c=typeof t.code<"u"?t.data||{}:t,f=Array.isArray(c.group_ids)?c.group_ids:[],p=[];for(const r of f){if(typeof r!="string")continue;const I=r.trim();I&&(p.includes(I)||p.push(I))}p.sort(),N.value=p}catch{}finally{ce(g.group_id),ce(V.group_id)}},me=async()=>{if(V.busy)return;let a=Number(V.count);if(!Number.isFinite(a)||a<=0){C.warning("取号个数需为正整数");return}a=Math.min(200,Math.floor(a)),V.count=a;const t=String(V.group_id||"").trim();t&&ce(t),V.results=Array.from({length:a},()=>({status:"pending",email:"",gpt_pwd:"",mail_pwd:"",rt:"",response:null,error:""})),V.busy=!0;let c=0;try{for(const p of V.results){p.status="running",p.error="",p.response=null;try{const r={};V.team_id&&(r.team_id=Number(V.team_id)),t&&(r.group_id=t);const I=await fetch("/_api/team/member",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!I.ok)throw new Error(await I.text());const L=await I.json();if(typeof L.code<"u"&&L.code!==0)throw new Error(L.message||`业务错误(code=${L.code})`);const T=typeof L.code<"u"?L.data||{}:L;p.status="success",p.response=T,p.email=H(T.mail||T.email||""),p.gpt_pwd=H(T.gpt_pwd),p.mail_pwd=H(T.mail_pwd),p.rt=H(T.rt),c++}catch(r){p.status="error",p.error=String(r?.message||r)}}const f=V.results.filter(p=>p.status==="error").length;c&&!f?C.success("批量取号完成"):c&&f?C.warning("部分取号失败，请查看列表"):c||C.error("取号全部失败"),c&&await A(!0)}finally{V.busy=!1}},ee=a=>{const t=String(a||"").trim().toLowerCase();return t?["1m","1","1month","1个月","1月","30d","2m","2","2month","2个月","2月","60d","3m","3","3month","3个月","3月","90d"].includes(t):!1},ke=a=>{const t=String(a||"").trim().toLowerCase();return!t||["1m","1","1month","1个月","1月","30d"].includes(t)?"1m":["2m","2","2month","2个月","2月","60d"].includes(t)?"2m":["3m","3","3month","3个月","3月","90d"].includes(t)?"3m":"1m"},Ie=a=>{if(!a)return"";const t=String(a);return t.length<=28?t:t.slice(0,12)+"…"+t.slice(-8)},je=()=>{const a=String(S.raw||"").split(/\r?\n/),t=[],c=[];let f=0;for(const r of a){f++;const I=String(r||"").trim();if(!I)continue;const L=I.split(P).map(se=>se.trim()).filter(Boolean);if(!L.length){c.push({lineNo:f,raw:I,reason:"分隔符格式错误"});continue}const T=[...L];let ae="";T.length>=2&&ee(T[T.length-1])&&(ae=ke(T.pop()));const[we,Qe,Ge,Ve,...Ee]=T;if(!Q.test(we)){c.push({lineNo:f,raw:I,reason:"邮箱格式错误"});continue}const Ae=H(Qe),We=H(Ge),le=H([Ve,...Ee].filter(Boolean).join("---")),o=ae||"1m";t.push({lineNo:f,raw:I,email:we,gpt_pwd:Ae,mail_pwd:We,rt:le,plan:o,status:"pending",error:"",busy:!1,response:null})}S.rows=t,S.failures=c;const p=a.filter(r=>String(r||"").trim()).length;Object.assign(S.stats,{total:p,ok:t.length,fail:c.length})},De=a=>a==="success"?"success":a==="error"?"danger":a==="running"?"info":"warning",d=a=>{switch(a.status){case"success":return"成功";case"error":return"失败";case"running":return"执行中";case"pending":default:return"待处理"}},n=a=>{const t=String(a.email||"").trim();return Q.test(t)?(a.email=t,["1m","2m","3m"].includes(a.plan)||(a.plan=ke(a.plan)),a.plan||(a.plan="1m"),a.gpt_pwd=H(a.gpt_pwd),a.mail_pwd=H(a.mail_pwd),a.rt=H(a.rt),!0):(a.status="error",a.error="邮箱格式错误",!1)},v=async a=>{if(!n(a))throw new Error(a.error||"数据校验失败");a.plan||(a.plan="1m"),a.busy=!0,a.status="running",a.error="",a.response=null;try{const t={team_id:S.team_id?Number(S.team_id):void 0,email:a.email};a.gpt_pwd&&(t.gpt_pwd=a.gpt_pwd,t.password=a.gpt_pwd),a.mail_pwd&&(t.mail_pwd=a.mail_pwd),a.rt&&(t.rt=a.rt),t.plan=a.plan||"1m";const c=await fetch("/_api/team/member",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!c.ok)throw new Error(await c.text());const f=await c.json();if(typeof f.code<"u"&&f.code!==0)throw new Error(f.message||`业务错误(code=${f.code})`);const p=typeof f.code<"u"?f.data||{}:f;a.status="success",a.response=p}catch(t){throw a.status="error",a.error=String(t?.message||t),t}finally{a.busy=!1}},E=async()=>{if(!S.busy){if(!S.rows.length){C.warning("请先解析有效数据");return}S.busy=!0;try{for(const a of S.rows)a.status!=="success"&&(a.status="pending",a.error="",a.response=null);for(const a of S.rows)if(a.status==="pending")try{await v(a)}catch{C.error(`第 ${a.lineNo} 行失败：${a.error}`);break}}finally{S.busy=!1,await A(!0)}}},z=async()=>{if(S.busy)return;const a=S.rows.filter(t=>t.status==="pending");if(!a.length){C.info("没有待处理的记录");return}S.busy=!0;try{for(const t of a)try{await v(t)}catch{C.error(`第 ${t.lineNo} 行失败：${t.error}`);break}}finally{S.busy=!1,await A(!0)}},O=async a=>{if(!S.busy){a.status="pending",a.error="",a.response=null,S.busy=!0;try{await v(a),await A(!0)}catch{C.error(`第 ${a.lineNo} 行失败：${a.error}`)}finally{S.busy=!1}}},A=async(a=!1)=>{if(a&&($.value=!0),!(!a&&!$.value)){W.value=!0;try{const t=new URLSearchParams;g.team_id&&t.set("team_id",String(g.team_id)),g.email&&t.set("email",g.email);const c=String(g.group_id||"").trim();c&&t.set("group_id",c),g.status!=null&&g.status!==""&&t.set("status",String(g.status)),t.set("page",String(k.page)),t.set("page_size",String(k.pageSize));const f=await fetch("/_api/team/members"+(t.toString()?"?"+t.toString():""));if(!f.ok)throw new Error(await f.text());const p=await f.json();if(typeof p.code<"u"&&p.code!==0)throw new Error(p.message||`业务错误(code=${p.code})`);const r=p&&typeof p.code<"u"?p.data||{}:p;D.value=r.list||[],D.value.forEach(ae=>ce(ae?.group_id));const I=Number(r.total??0);Number.isNaN(I)||(k.total=I);const L=Number(r.page);!Number.isNaN(L)&&L>0&&(k.page=L);const T=Number(r.page_size);!Number.isNaN(T)&&T>0&&(k.pageSize=T)}catch(t){C.error(String(t))}finally{$.value&&await pe().catch(()=>{}),W.value=!1}}},K=()=>{Object.assign(x,{id:void 0,team_id:g.team_id||void 0,email:"",uid:"",status:2,plan:""}),F.isEdit=!1,F.visible=!0},ne=a=>{Object.assign(x,{id:a.id,team_id:a.team_id,email:a.email,uid:String(a.uid??""),status:Number(a.status)}),F.isEdit=!0,F.visible=!0},i=async()=>{M.value=!0;try{if(F.isEdit){const a={id:x.id},t=Number(x.uid);!Number.isNaN(t)&&Number.isFinite(t)&&(a.uid=t),a.status=x.status;const c=await fetch("/_api/team/member",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!c.ok)throw new Error(await c.text());const f=await c.json();if(typeof f.code<"u"&&f.code!==0)throw new Error(f.message||`业务错误(code=${f.code})`);C.success("更新成功")}else{const a={team_id:x.team_id,email:x.email};if(!a.email)throw new Error("email 必填");const t=Number(x.uid);!Number.isNaN(t)&&Number.isFinite(t)&&t>0&&(a.uid=t),x.plan&&(a.plan=x.plan);const c=await fetch("/_api/team/member",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!c.ok)throw new Error(await c.text());const f=await c.json();if(typeof f.code<"u"&&f.code!==0)throw new Error(f.message||`业务错误(code=${f.code})`);C.success("添加成功")}F.visible=!1,await A(!0)}catch(a){C.error(String(a))}finally{M.value=!1}},s=async a=>{if(!a||!a.email){C.error("当前记录缺少邮箱，无法邀请");return}const t=Number(a.team_id);if(!t){C.error("当前记录缺少 Team ID，无法邀请");return}try{await Ze.confirm(`确认强制邀请 ${a.email} 到团队 ${t} 吗？`,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"})}catch{return}a.__forcing=!0;try{const c={team_id:t,email:a.email,force:!0},f=Number(a.uid);!Number.isNaN(f)&&Number.isFinite(f)&&f>0&&(c.uid=f);const p=await fetch("/_api/team/member",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!p.ok)throw new Error(await p.text());const r=await p.json();if(typeof r.code<"u"&&r.code!==0)throw new Error(r.message||`业务错误(code=${r.code})`);C.success("强制邀请成功"),await A(!0)}catch(c){C.error(String(c))}finally{a.__forcing=!1}},u=async a=>{B.value=!0;try{const t=new URLSearchParams;a&&t.set("email",a),t.set("page","1"),t.set("page_size","50");const c=await fetch("/_api/teams"+(t.toString()?"?"+t.toString():""));if(!c.ok)throw new Error(await c.text());const f=await c.json();if(typeof f.code<"u"&&f.code!==0)throw new Error(f.message||`业务错误(code=${f.code})`);const p=f&&typeof f.code<"u"?f.data||{}:f;U.value=(p.list||[]).map(I=>({value:Number(I.id),label:I.email}));const r=g.team_id||x.team_id||S.team_id||V.team_id;r&&!U.value.some(I=>Number(I.value)===Number(r))&&U.value.unshift({value:Number(r),label:`#${r}`})}catch{}finally{B.value=!1}};at(async()=>{u(""),await be(),await re(Y.query,{triggerLoad:!0})}),ge(()=>g.group_id,a=>{ce(a)}),ge(()=>Y.query,async a=>{if(Se)return;const t=de(a),c=ue();Ue(t,c)||await re(a,{triggerLoad:!0})}),ge(()=>V.group_id,a=>{ce(a)});const m=a=>a<10?"0"+a:""+a,b=a=>{if(!a)return"";if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(a))return a;let t;if(typeof a=="number")t=a>1e12?new Date(a):new Date(a*1e3);else if(/^\d{10,13}$/.test(a)){const T=Number(a);t=T>1e12?new Date(T):new Date(T*1e3)}else{const T=String(a).replace("T"," ").replace("Z","");t=new Date(T),isNaN(t.getTime())&&(t=new Date(a))}if(isNaN(t.getTime()))return a;const c=t.getFullYear(),f=m(t.getMonth()+1),p=m(t.getDate()),r=m(t.getHours()),I=m(t.getMinutes()),L=m(t.getSeconds());return`${c}-${f}-${p} ${r}:${I}:${L}`};return(a,t)=>{const c=ot,f=dt,p=rt,r=nt,I=ut,L=st,T=ct,ae=mt,we=pt,Qe=Et,Ge=gt,Ve=it,Ee=yt,Ae=kt,We=ft,le=_t;return h(),j("div",ua,[e(Ge,{shadow:"never"},{header:l(()=>[J("div",ma,[t[26]||(t[26]=_(" 成员管理 ",-1)),J("div",pa,[e(c,{size:"small",onClick:Je},{default:l(()=>[...t[23]||(t[23]=[_("批量取Team号",-1)])]),_:1}),e(c,{size:"small",onClick:Fe},{default:l(()=>[...t[24]||(t[24]=[_("批量添加",-1)])]),_:1}),e(c,{type:"primary",size:"small",onClick:K},{default:l(()=>[...t[25]||(t[25]=[_("添加",-1)])]),_:1})])])]),default:l(()=>[e(L,{inline:!0,model:g,class:"filters",onSubmit:t[5]||(t[5]=bt(()=>{},["prevent"]))},{default:l(()=>[e(r,{label:"Team"},{default:l(()=>[e(p,{modelValue:g.team_id,"onUpdate:modelValue":t[0]||(t[0]=o=>g.team_id=o),clearable:"",filterable:"",remote:"","remote-method":u,loading:B.value,placeholder:"搜索邮箱关键字",style:{width:"260px"},onChange:t[1]||(t[1]=o=>g.team_id=o===""||o==null?void 0:Number(o))},{default:l(()=>[(h(!0),j(fe,null,he(U.value,o=>(h(),R(f,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),e(r,{label:"邮箱"},{default:l(()=>[e(I,{modelValue:g.email,"onUpdate:modelValue":t[2]||(t[2]=o=>g.email=o),placeholder:"精确匹配",clearable:""},null,8,["modelValue"])]),_:1}),e(r,{label:"状态"},{default:l(()=>[e(p,{modelValue:g.status,"onUpdate:modelValue":t[3]||(t[3]=o=>g.status=o),clearable:"",placeholder:"全部",style:{width:"140px"},onChange:t[4]||(t[4]=o=>g.status=o===""||o==null?null:Number(o))},{default:l(()=>[e(f,{value:1,label:"已邀请(1)"}),e(f,{value:2,label:"已进入(2)"}),e(f,{value:3,label:"离开(3)"})]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:l(()=>[e(c,{type:"primary",onClick:Me},{default:l(()=>[...t[27]||(t[27]=[_("查询",-1)])]),_:1}),e(c,{onClick:Be},{default:l(()=>[...t[28]||(t[28]=[_("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),ve((h(),R(we,{data:D.value,size:"small",border:!0},{default:l(()=>[e(T,{prop:"id",label:"ID",width:"80"}),e(T,{prop:"team_id",label:"Team ID",width:"100"}),e(T,{prop:"uid",label:"UID",width:"100"}),e(T,{prop:"email",label:"邮箱"}),e(T,{prop:"status",label:"状态",width:"90"},{default:l(({row:o})=>[e(ae,{type:Number(o.status)===2?"success":Number(o.status)===1?"info":"warning"},{default:l(()=>[_(w(Number(o.status)===1?"已邀请(1)":Number(o.status)===2?"已进入(2)":"离开(3)"),1)]),_:2},1032,["type"])]),_:1}),e(T,{prop:"start_time",label:"开始时间",width:"180"},{default:l(({row:o})=>[_(w(b(o.start_time)),1)]),_:1}),e(T,{prop:"end_time",label:"结束时间",width:"180"},{default:l(({row:o})=>[_(w(b(o.end_time)),1)]),_:1}),e(T,{prop:"created_at",label:"创建时间",width:"180"},{default:l(({row:o})=>[_(w(b(o.created_at)),1)]),_:1}),e(T,{label:"操作",width:"200",fixed:"right"},{default:l(({row:o})=>[e(c,{link:"",size:"small",loading:o.__forcing===!0,disabled:!o.email,onClick:se=>s(o)},{default:l(()=>[...t[29]||(t[29]=[_("强制邀请",-1)])]),_:1},8,["loading","disabled","onClick"]),e(c,{link:"",size:"small",onClick:se=>ne(o)},{default:l(()=>[...t[30]||(t[30]=[_("编辑",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,W.value]]),J("div",ca,[e(Qe,{layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"current-page":k.page,"page-size":k.pageSize,total:k.total,onCurrentChange:qe,onSizeChange:$e},null,8,["current-page","page-size","total"])])]),_:1}),e(Ee,{modelValue:V.visible,"onUpdate:modelValue":t[11]||(t[11]=o=>V.visible=o),title:"批量取Team号",width:"720px"},{footer:l(()=>[e(c,{onClick:t[10]||(t[10]=o=>V.visible=!1),disabled:V.busy},{default:l(()=>[...t[33]||(t[33]=[_("关闭",-1)])]),_:1},8,["disabled"])]),default:l(()=>[e(L,{"label-width":"120px",model:V,style:{"margin-bottom":"12px"}},{default:l(()=>[e(r,{label:"取号个数"},{default:l(()=>[e(Ve,{modelValue:V.count,"onUpdate:modelValue":t[6]||(t[6]=o=>V.count=o),min:1,max:200,disabled:V.busy},null,8,["modelValue","disabled"])]),_:1}),e(r,{label:"分组ID"},{default:l(()=>[e(p,{modelValue:V.group_id,"onUpdate:modelValue":t[7]||(t[7]=o=>V.group_id=o),clearable:"",filterable:"","allow-create":"",placeholder:"默认 default",style:{width:"260px"},disabled:V.busy},{default:l(()=>[(h(!0),j(fe,null,he(N.value,o=>(h(),R(f,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),e(r,{label:"Team"},{default:l(()=>[e(p,{modelValue:V.team_id,"onUpdate:modelValue":t[8]||(t[8]=o=>V.team_id=o),clearable:"",filterable:"",remote:"","remote-method":u,loading:B.value,placeholder:"未选择时自动分配",style:{width:"260px"},disabled:V.busy,onChange:t[9]||(t[9]=o=>V.team_id=o===""||o==null?void 0:Number(o))},{default:l(()=>[(h(!0),j(fe,null,he(U.value,o=>(h(),R(f,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"])]),_:1})]),_:1},8,["model"]),J("div",fa,[e(c,{type:"primary",size:"small",loading:V.busy,disabled:V.busy,onClick:me},{default:l(()=>[...t[31]||(t[31]=[_(" 开始取号 ",-1)])]),_:1},8,["loading","disabled"]),t[32]||(t[32]=J("span",{class:"auto-export-tip"},"导出内容实时生成",-1)),e(ae,{size:"small",type:"info"},{default:l(()=>[_("已成功 "+w(q.value)+" 条",1)]),_:1}),xe.value?(h(),R(ae,{key:0,size:"small",type:"danger"},{default:l(()=>[_(" 失败 "+w(xe.value)+" 条 ",1)]),_:1})):G("",!0)]),ve((h(),R(we,{data:V.results,size:"small",border:!0,"empty-text":V.busy?"取号中...":"暂无数据",style:{"margin-bottom":"12px"}},{default:l(()=>[e(T,{type:"index",width:"60",label:"#"}),e(T,{label:"邮箱","min-width":"220"},{default:l(({row:o})=>[_(w(o.email||o.response?.mail||"-"),1)]),_:1}),e(T,{label:"GPT 密码","min-width":"160"},{default:l(({row:o})=>[_(w(o.gpt_pwd||o.response?.gpt_pwd||"-"),1)]),_:1}),e(T,{label:"邮箱密码","min-width":"160"},{default:l(({row:o})=>[_(w(o.mail_pwd||o.response?.mail_pwd||"-"),1)]),_:1}),e(T,{label:"RT","min-width":"240"},{default:l(({row:o})=>[_(w(Ie(o.rt||o.response?.rt)||"-"),1)]),_:1}),e(T,{label:"状态",width:"120"},{default:l(({row:o})=>[e(ae,{type:De(o.status)},{default:l(()=>[_(w(d(o)),1)]),_:2},1032,["type"])]),_:1}),e(T,{label:"返回信息","min-width":"200"},{default:l(({row:o})=>[o.status==="success"?(h(),j("span",_a,[_(" ID: "+w(o.response?.id)+" ",1),o.response?.mail?(h(),j("span",ga,"｜"+w(o.response.mail),1)):G("",!0),o.response?.gpt_pwd?(h(),j("span",ya,"｜GPT: "+w(o.response.gpt_pwd),1)):G("",!0),o.response?.mail_pwd?(h(),j("span",ba,"｜邮箱密码: "+w(o.response.mail_pwd),1)):G("",!0),o.response?.rt?(h(),j("span",wa,"｜RT: "+w(Ie(o.response.rt)),1)):G("",!0)])):o.status==="error"?(h(),j("span",va,w(o.error),1)):o.status==="running"?(h(),j("span",ha,"执行中...")):(h(),j("span",Sa,"待处理"))]),_:1})]),_:1},8,["data","empty-text"])),[[le,V.busy]]),Ne.value?(h(),j("div",ka,[e(L,{"label-width":"120px"},{default:l(()=>[e(r,{label:"导出结果"},{default:l(()=>[e(I,{"model-value":Ne.value,type:"textarea",rows:6,readonly:""},null,8,["model-value"])]),_:1})]),_:1})])):G("",!0)]),_:1},8,["modelValue"]),e(Ee,{modelValue:S.visible,"onUpdate:modelValue":t[15]||(t[15]=o=>S.visible=o),title:"批量添加成员",width:"860px"},{footer:l(()=>[e(c,{onClick:t[14]||(t[14]=o=>S.visible=!1),disabled:S.busy},{default:l(()=>[...t[38]||(t[38]=[_("关闭",-1)])]),_:1},8,["disabled"]),e(c,{onClick:je,disabled:S.busy},{default:l(()=>[...t[39]||(t[39]=[_("重新解析",-1)])]),_:1},8,["disabled"])]),default:l(()=>[e(L,{"label-width":"120px",style:{"margin-bottom":"12px"}},{default:l(()=>[e(r,{label:"Team"},{default:l(()=>[e(p,{modelValue:S.team_id,"onUpdate:modelValue":t[12]||(t[12]=o=>S.team_id=o),clearable:"",filterable:"",remote:"","remote-method":u,loading:B.value,placeholder:"未选择时自动分配"},{default:l(()=>[(h(!0),j(fe,null,he(U.value,o=>(h(),R(f,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),e(r,{label:"成员数据"},{default:l(()=>[e(I,{modelValue:S.raw,"onUpdate:modelValue":t[13]||(t[13]=o=>S.raw=o),type:"textarea",rows:6,placeholder:"每行一条，支持“---”或“----”分隔。例如：\\nuser1@example.com---gptPass1---mailPass1---rt_xxx\\nuser2@example.com---gptPass2---mailPass2---rt_yyy"},null,8,["modelValue"])]),_:1})]),_:1}),J("div",Va,[e(Ae,null,{default:l(()=>[e(ae,null,{default:l(()=>[_("共 "+w(S.stats.total)+" 行",1)]),_:1}),e(ae,{type:"success"},{default:l(()=>[_("有效 "+w(S.stats.ok),1)]),_:1}),S.failures.length?(h(),R(ae,{key:0,type:"danger"},{default:l(()=>[_("失败 "+w(S.stats.fail),1)]),_:1})):G("",!0),e(c,{size:"small",onClick:je},{default:l(()=>[...t[34]||(t[34]=[_("解析",-1)])]),_:1})]),_:1}),e(c,{size:"small",style:{"margin-left":"auto"},disabled:!S.rows.length||S.busy,loading:S.busy,type:"primary",onClick:E},{default:l(()=>[...t[35]||(t[35]=[_("开始添加",-1)])]),_:1},8,["disabled","loading"]),e(c,{size:"small",disabled:!te.value||S.busy,loading:S.busy,onClick:z},{default:l(()=>[...t[36]||(t[36]=[_("继续",-1)])]),_:1},8,["disabled","loading"])]),S.failures.length?(h(),R(We,{key:0,type:"warning","show-icon":"",closable:!1,class:"mb8",title:"以下行解析失败，已忽略："})):G("",!0),S.failures.length?(h(),R(we,{key:1,data:S.failures,size:"small",border:!0,style:{"margin-bottom":"12px"}},{default:l(()=>[e(T,{prop:"lineNo",label:"#",width:"70"}),e(T,{prop:"raw",label:"原始数据","min-width":"260"}),e(T,{prop:"reason",label:"原因","min-width":"160"})]),_:1},8,["data"])):G("",!0),ve((h(),R(we,{data:S.rows,size:"small",border:!0,"empty-text":S.stats.total?"无有效数据":"请先解析"},{default:l(()=>[e(T,{type:"index",width:"60",label:"#"}),e(T,{label:"邮箱","min-width":"240"},{default:l(({row:o})=>[e(I,{modelValue:o.email,"onUpdate:modelValue":se=>o.email=se,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(T,{label:"GPT 密码","min-width":"160"},{default:l(({row:o})=>[e(I,{modelValue:o.gpt_pwd,"onUpdate:modelValue":se=>o.gpt_pwd=se,size:"small",placeholder:"可选"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(T,{label:"邮箱密码","min-width":"160"},{default:l(({row:o})=>[e(I,{modelValue:o.mail_pwd,"onUpdate:modelValue":se=>o.mail_pwd=se,size:"small",placeholder:"可选"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(T,{label:"RT","min-width":"260"},{default:l(({row:o})=>[e(I,{modelValue:o.rt,"onUpdate:modelValue":se=>o.rt=se,size:"small",type:"textarea",autosize:{minRows:1,maxRows:3},placeholder:"可选",style:{"font-family":"monospace"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(T,{label:"激活时长",width:"140"},{default:l(({row:o})=>[e(p,{modelValue:o.plan,"onUpdate:modelValue":se=>o.plan=se,size:"small",placeholder:"1个月"},{default:l(()=>[e(f,{label:"1个月",value:"1m"}),e(f,{label:"2个月",value:"2m"}),e(f,{label:"3个月",value:"3m"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1}),e(T,{label:"状态",width:"120"},{default:l(({row:o})=>[e(ae,{type:De(o.status)},{default:l(()=>[_(w(d(o)),1)]),_:2},1032,["type"])]),_:1}),e(T,{label:"返回信息","min-width":"200"},{default:l(({row:o})=>[o.status==="success"?(h(),j("span",Ea,[_(" ID: "+w(o.response?.id)+" ",1),o.response?.mail?(h(),j("span",xa,"｜"+w(o.response.mail),1)):G("",!0),o.response?.gpt_pwd?(h(),j("span",Na,"｜GPT: "+w(o.response.gpt_pwd),1)):G("",!0),o.response?.mail_pwd?(h(),j("span",Ta,"｜邮箱密码: "+w(o.response.mail_pwd),1)):G("",!0),o.response?.rt?(h(),j("span",Ca,"｜RT: "+w(Ie(o.response.rt)),1)):G("",!0)])):o.status==="error"?(h(),j("span",za,w(o.error),1)):o.status==="running"?(h(),j("span",$a,"执行中...")):(h(),j("span",Ia,"待处理"))]),_:1}),e(T,{label:"操作",width:"120",fixed:"right"},{default:l(({row:o})=>[e(c,{link:"",size:"small",disabled:o.status==="success"||S.busy,loading:o.busy,onClick:se=>O(o)},{default:l(()=>[...t[37]||(t[37]=[_(" 重试 ",-1)])]),_:1},8,["disabled","loading","onClick"])]),_:1})]),_:1},8,["data","empty-text"])),[[le,S.busy]])]),_:1},8,["modelValue"]),e(Ee,{modelValue:F.visible,"onUpdate:modelValue":t[22]||(t[22]=o=>F.visible=o),title:F.isEdit?"编辑成员":"添加成员",width:"560px"},{footer:l(()=>[e(c,{onClick:t[21]||(t[21]=o=>F.visible=!1)},{default:l(()=>[...t[40]||(t[40]=[_("取消",-1)])]),_:1}),e(c,{type:"primary",loading:M.value,onClick:i},{default:l(()=>[...t[41]||(t[41]=[_("保存",-1)])]),_:1},8,["loading"])]),default:l(()=>[e(L,{model:x,"label-width":"120px"},{default:l(()=>[F.isEdit?(h(),R(r,{key:0,label:"ID"},{default:l(()=>[e(I,{modelValue:x.id,"onUpdate:modelValue":t[16]||(t[16]=o=>x.id=o),modelModifiers:{number:!0},disabled:""},null,8,["modelValue"])]),_:1})):G("",!0),e(r,{label:"Team"},{default:l(()=>[e(p,{modelValue:x.team_id,"onUpdate:modelValue":t[17]||(t[17]=o=>x.team_id=o),disabled:F.isEdit,clearable:"",filterable:"",remote:"","remote-method":u,loading:B.value,placeholder:"搜索邮箱关键字"},{default:l(()=>[(h(!0),j(fe,null,he(U.value,o=>(h(),R(f,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled","loading"])]),_:1}),e(r,{label:"邮箱"},{default:l(()=>[e(I,{modelValue:x.email,"onUpdate:modelValue":t[18]||(t[18]=o=>x.email=o),disabled:F.isEdit},null,8,["modelValue","disabled"])]),_:1}),e(r,{label:"UID"},{default:l(()=>[e(I,{modelValue:x.uid,"onUpdate:modelValue":t[19]||(t[19]=o=>x.uid=o),placeholder:"可选，数字"},null,8,["modelValue"])]),_:1}),F.isEdit?G("",!0):(h(),R(r,{key:1,label:"时间计划"},{default:l(()=>[e(p,{modelValue:x.plan,"onUpdate:modelValue":t[20]||(t[20]=o=>x.plan=o),clearable:"",placeholder:"可选"},{default:l(()=>[e(f,{label:"1个月",value:"1m"}),e(f,{label:"2个月",value:"2m"}),e(f,{label:"3个月",value:"3m"})]),_:1},8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ua=Xe(Pa,[["__scopeId","data-v-24916fb1"]]),Ct=Object.freeze(Object.defineProperty({__proto__:null,default:Ua},Symbol.toStringTag,{value:"Module"})),Oa={class:"team-owner-list"},ja={class:"card-header"},Da={class:"title"},Aa={class:"actions"},Ra={class:"table-pagination"},La={class:"details-container"},Ma={class:"bulk-result-body"},Ba={style:{"max-height":"540px",overflow:"auto"}},qa={key:0,style:{"margin-top":"8px"}},Fa={key:0},Ja={style:{"margin-top":"8px","text-align":"right"}},Qa={style:{"margin-top":"6px"}},Ga={style:{"white-space":"pre-wrap","word-break":"break-all"}},Wa={__name:"Owner",setup(ie){const W=Z(!1),M=Z(!1),g=X({email:"",group_id:null,status:null}),$=Z(!1),k=X({page:1,pageSize:20,total:0}),D=Z([]),U=X({total_seats:0,used_seats:0,remain:0,available_mails:0}),B=X({visible:!1,isEdit:!1}),N=X({id:void 0,email:"",password:"",seats:1,status:1,rt:"",group_id:null}),Y=Z([]),oe=tt(),F=ht(),x=X({visible:!1,loading:!1,activeTab:"users",teamId:void 0,usersView:[],pendingView:[]}),P=X({visible:!1,loading:!1,teamId:void 0,data:{},showRaw:!1}),Q=X({visible:!1,running:!1,logs:[]}),H=["email","group_id","status","queried"];let S=!1;const V=i=>Array.isArray(i)?i[i.length-1]:i,te=i=>{const s=V(i);return typeof s=="string"?s:""},q=i=>{const s=V(i);if(typeof s!="string")return null;const u=s.trim();return u||null},xe=i=>{const s=V(i);if(s==null||s==="")return null;const u=Number(s);return Number.isFinite(u)?u:null},Ne=i=>V(i)==="1",Te=i=>{const s={};for(const u of H){const m=i[u];if(Array.isArray(m)){if(!m.length)continue;const b=m[m.length-1];if(b==null||b==="")continue;s[u]=b;continue}m==null||m===""||(s[u]=m)}return s},Se=(i,s)=>{const u=Object.entries(i).sort((b,a)=>b[0].localeCompare(a[0])),m=Object.entries(s).sort((b,a)=>b[0].localeCompare(a[0]));if(u.length!==m.length)return!1;for(let b=0;b<u.length;b++)if(u[b][0]!==m[b][0]||u[b][1]!==m[b][1])return!1;return!0},_e=()=>{const i={};g.email&&(i.email=g.email);const s=typeof g.group_id=="string"?g.group_id.trim():"";return s&&(i.group_id=s),g.status!==null&&g.status!==void 0&&g.status!==""&&(i.status=String(g.status)),$.value&&(i.queried="1"),i},ye=async()=>{const i=_e(),s=Te(oe.query);if(Se(s,i))return;const u={};for(const[m,b]of Object.entries(oe.query))H.includes(m)||(u[m]=b);S=!0;try{await F.replace({query:{...u,...i}})}finally{S=!1}},Pe=async(i,{triggerLoad:s=!1}={})=>{const u=te(i.email),m=q(i.group_id),b=xe(i.status),t=Ne(i.queried)||!!u||m!==null||b!==null;if(g.email!==u&&(g.email=u),g.group_id!==m&&(g.group_id=m),g.status!==b&&(g.status=b),$.value=t,!t){s&&(D.value=[],k.total=0,k.page=1,U.total_seats=0,U.used_seats=0,U.remain=0,U.available_mails=0);return}s&&(k.page=1,await ue(!0),await pe(!0))},Ce=()=>{g.email="",g.group_id=null,g.status=null},Le=async()=>{$.value=!0,k.page=1,await ue(!0),await pe(!0)},ze=async()=>{Ce(),k.page=1,$.value=!1,D.value=[],k.total=0,U.total_seats=0,U.used_seats=0,U.remain=0,U.available_mails=0,await ye()},de=i=>{$.value&&(k.page=i,ue())},Ue=i=>{$.value&&(k.pageSize=i,k.page=1,ue())},ue=async(i=!1)=>{if(i&&($.value=!0),!(!i&&!$.value)){W.value=!0;try{const s=new URLSearchParams;g.email&&s.set("email",g.email),g.status!=null&&g.status!==""&&s.set("status",String(g.status));const u=String(g.group_id||"").trim();u&&s.set("group_id",u),s.set("page",String(k.page)),s.set("page_size",String(k.pageSize));const m=await fetch("/_api/teams"+(s.toString()?"?"+s.toString():""));if(!m.ok)throw new Error(await m.text());const b=await m.json();if(typeof b.code<"u"&&b.code!==0)throw new Error(b.message||`业务错误(code=${b.code})`);const a=b&&typeof b.code<"u"?b.data||{}:b;D.value=a.list||[],D.value.forEach(p=>re(p.group_id));const t=Number(a.total??0);Number.isNaN(t)||(k.total=t);const c=Number(a.page);!Number.isNaN(c)&&c>0&&(k.page=c);const f=Number(a.page_size);!Number.isNaN(f)&&f>0&&(k.pageSize=f)}catch(s){C.error(String(s))}finally{$.value&&await ye().catch(()=>{}),W.value=!1}}},pe=async(i=!1)=>{if(i&&($.value=!0),!(!i&&!$.value))try{const s=new URLSearchParams,u=String(g.group_id||"").trim();u&&s.set("group_id",u);const m=await fetch("/_api/app/remain"+(s.toString()?"?"+s.toString():""));if(!m.ok)throw new Error(await m.text());const b=await m.json(),a=typeof b.code<"u"?b.data||{}:b;U.total_seats=Number(a.total_seats||0),U.used_seats=Number(a.used_seats||0),U.remain=Number(a.remain||0),U.available_mails=Number(a.available_mails||0)}catch{}},re=i=>{const s=typeof i=="string"?i.trim():String(i??"").trim();s&&(Y.value.includes(s)||(Y.value=[...Y.value,s].sort()))},Oe=async()=>{try{const i=await fetch("/_api/team/group_ids");if(!i.ok)throw new Error(await i.text());const s=await i.json();if(typeof s.code<"u"&&s.code!==0)throw new Error(s.message||`业务错误(code=${s.code})`);const u=typeof s.code<"u"?s.data||{}:s,m=Array.isArray(u.group_ids)?u.group_ids:[],b=[];for(const a of m){if(typeof a!="string")continue;const t=a.trim();t&&(b.includes(t)||b.push(t))}b.sort(),Y.value=b}catch{}finally{re(g.group_id),re(N.group_id),D.value.forEach(i=>re(i.group_id))}};ge(()=>g.group_id,i=>{re(i),pe()}),ge(()=>oe.query,async i=>{if(S)return;const s=Te(i),u=_e();Se(s,u)||await Pe(i,{triggerLoad:!0})}),ge(()=>N.group_id,i=>{re(i)});const Me=()=>{Object.assign(N,{id:void 0,email:"",password:"",seats:1,status:1,rt:"",group_id:null}),B.isEdit=!1,B.visible=!0},Be=i=>{Object.assign(N,{id:i.id,email:i.email,password:"",seats:i.seats,status:Number(i.status),rt:i.rt,group_id:i.group_id||null}),re(N.group_id),B.isEdit=!0,B.visible=!0},qe=async()=>{M.value=!0;try{let i="/_api/team",s="POST",u;if(B.isEdit)s="PUT",u={id:N.id},N.seats&&(u.seats=N.seats),N.password&&(u.password=N.password),N.status&&(u.status=N.status),N.rt&&(u.rt=N.rt),N.group_id!==void 0&&(u.group_id=String(N.group_id||"").trim());else{if(!N.password)throw new Error("创建时需要填写密码");const{id:t,group_id:c,...f}=N;u={...f};const p=String(c||"").trim();p&&(u.group_id=p)}const m=await fetch(i,{method:s,headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!m.ok)throw new Error(await m.text());const b=await m.json();if(typeof b.code<"u"&&b.code!==0)throw new Error(b.message||`业务错误(code=${b.code})`);C.success("保存成功"),B.visible=!1;const a=u&&typeof u.group_id=="string"?u.group_id:"";await ue(!0),await pe(!0),re(a),Oe()}catch(i){C.error(String(i))}finally{M.value=!1}},$e=async i=>{x.visible=!0,x.activeTab="users",x.teamId=i.id,x.loading=!0;try{const s=new URLSearchParams({team_id:String(i.id)}),u=await fetch("/_api/team/external?"+s.toString());if(!u.ok)throw new Error(await u.text());const m=await u.json();if(typeof m.code<"u"&&m.code!==0)throw new Error(m.message||`业务错误(code=${m.code})`);const b=m&&typeof m.code<"u"?m.data||{}:m,a=Array.isArray(b.members)?b.members:[],t=new Set(a.map(f=>String(f.email||"").toLowerCase())),c=f=>(Array.isArray(f)?f:[]).map(p=>({id:p.id,email:p.email_address||p.email||"",role:p.role||"",created_time:p.created_time||"",isWhitelist:t.has(String(p.email_address||p.email||"").toLowerCase())}));x.usersView=c(b.users),x.pendingView=c(b.pending)}catch(s){C.error(String(s))}finally{x.loading=!1}},Fe=async i=>{try{if(String(i.role)==="account-owner")return;const s={team_id:x.teamId,user_id:i.id,email:i.email},u=await fetch("/_api/team/external",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!u.ok)throw new Error(await u.text());const m=await u.json();if(typeof m.code<"u"&&m.code!==0)throw new Error(m.message||"删除失败");C.success("已移除"),$e({id:x.teamId})}catch(s){C.error(String(s))}},Je=async i=>{try{if(String(i.role)==="account-owner")return;const s={team_id:x.teamId,email:i.email},u=await fetch("/_api/team/external",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!u.ok)throw new Error(await u.text());const m=await u.json();if(typeof m.code<"u"&&m.code!==0)throw new Error(m.message||"删除失败");C.success("已移除"),$e({id:x.teamId})}catch(s){C.error(String(s))}},ce=async i=>{try{if(!i.rt){C.error("该 Owner 未配置 RT，无法刷新");return}const s=await fetch("/_api/team/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:i.id})});if(!s.ok)throw new Error(await s.text());const u=await s.json();if(typeof u.code<"u"&&u.code!==0)throw new Error(u.message||`业务错误(code=${u.code})`);C.success("刷新成功"),await ue(!0)}catch(s){C.error(String(s))}};at(async()=>{await Oe(),await Pe(oe.query,{triggerLoad:!0})});const be=i=>i<10?"0"+i:""+i,me=i=>{if(!i)return"";if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(i))return i;let s;if(typeof i=="number")s=i>1e12?new Date(i):new Date(i*1e3);else if(/^\d{10,13}$/.test(i)){const f=Number(i);s=f>1e12?new Date(f):new Date(f*1e3)}else{const f=i.replace("T"," ").replace("Z","");s=new Date(f),isNaN(s.getTime())&&(s=new Date(i))}if(isNaN(s.getTime()))return i;const u=s.getFullYear(),m=be(s.getMonth()+1),b=be(s.getDate()),a=be(s.getHours()),t=be(s.getMinutes()),c=be(s.getSeconds());return`${u}-${m}-${b} ${a}:${t}:${c}`},ee=async i=>{if(!i)throw new Error("缺少团队ID");const s=new URLSearchParams({team_id:String(i)}),u=await fetch("/_api/team/subscription?"+s.toString());if(!u.ok)throw new Error(await u.text());const m=await u.json();if(typeof m.code<"u"&&m.code!==0)throw new Error(m.message||`业务错误(code=${m.code})`);let b=(typeof m.code<"u"?m.data||{}:m)||{};return b&&b.data&&typeof b.data=="object"&&(b=b.data),b},ke=async i=>{const s=await fetch("/_api/team/subscription/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:i})});if(!s.ok)throw new Error(await s.text());const u=await s.json();if(typeof u.code<"u"&&u.code!==0)throw new Error(u.message||"取消失败");return u},Ie=i=>i===!0||i===!1?i:typeof i=="string"?["true","1","yes","on"].includes(i.toLowerCase()):typeof i=="number"?i===1:!1,je=async()=>{const i=Array.isArray(D.value)?[...D.value]:[];if(!i.length){C.info("当前列表为空");return}try{await Ze.confirm("确认对当前列表中的所有团队执行一键退订？","提示",{type:"warning",confirmButtonText:"开始执行",cancelButtonText:"取消"})}catch{return}Q.visible=!0,Q.logs=[],Q.running=!0;try{for(const s of i){const u={id:s?.id,email:s?.email||"",status:"pending",message:"等待处理"};if(Q.logs.push(u),!s?.id){u.status="skipped",u.message="缺少团队ID，已跳过";continue}try{u.status="checking",u.message="查询订阅状态中...";const m=await ee(s.id),b=Ie(m?.will_renew);if(!m||Object.keys(m).length===0){u.status="skipped",u.message="未查询到订阅记录";continue}if(!b){u.status="success",u.message="已退订";continue}u.status="cancelling",u.message="检测到自动续费，正在取消...",await ke(s.id),u.status="success",u.message="取消成功"}catch(m){u.status="error",u.message=`失败：${String(m?.message||m)}`}}C.success("批量退订已完成")}finally{Q.running=!1}},De=i=>({pending:"等待处理",checking:"查询中",cancelling:"取消中",success:"取消成功",skipped:"已跳过",error:"失败"})[i]||i,d=i=>({success:"success",skipped:"info",error:"danger",cancelling:"warning",checking:"warning",pending:"info"})[i]||"info",n=(i,s)=>{if(i==="status")return v(s);if(i==="cancel")return E(s);if(i==="delete")return z(s)},v=async i=>{P.visible=!0,P.loading=!0,P.teamId=i?.id,P.showRaw=!1,P.data={};try{P.data=await ee(i.id)}catch(s){C.error(String(s))}finally{P.loading=!1}},E=async i=>{try{if(!i?.id)return;try{await Ze.confirm("确认取消该团队的订阅？","提示",{type:"warning",confirmButtonText:"确认",cancelButtonText:"取消"})}catch{return}await ke(i.id),C.success("已提交取消订阅")}catch(s){C.error(String(s))}},z=async i=>{try{if(!i?.id)return;try{await Ze.confirm("确认删除该团队？删除后将清除所有关联成员，且不可恢复。","提示",{type:"warning",confirmButtonText:"确认删除",cancelButtonText:"取消"})}catch{return}const s=await fetch("/_api/team",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:i.id})});if(!s.ok)throw new Error(await s.text());const u=await s.json();if(typeof u.code<"u"&&u.code!==0)throw new Error(u.message||"删除失败");C.success("删除成功"),await ue(!0),await pe(!0)}catch(s){C.error(String(s))}},O=i=>{try{return JSON.stringify(i||{},null,2)}catch{return String(i)}},A=i=>({team:"团队",plus:"Plus",pro:"Pro",enterprise:"企业",free:"免费"})[i]||i||"-",K=i=>({monthly:"月付",yearly:"年付",annual:"年付"})[i]||i||"-",ne=()=>{x.loading=!1,x.teamId=void 0,x.activeTab="users",x.usersView=[],x.pendingView=[]};return(i,s)=>{const u=mt,m=ot,b=ut,a=nt,t=dt,c=rt,f=st,p=ct,r=St,I=Rt,L=At,T=Dt,ae=pt,we=Et,Qe=gt,Ge=it,Ve=yt,Ee=Vt,Ae=Mt,We=Lt,le=qt,o=Bt,se=ft,He=_t;return h(),j("div",Oa,[e(Qe,{shadow:"never"},{header:l(()=>[J("div",ja,[J("div",Da,[s[22]||(s[22]=_(" 团队管理 ",-1)),e(u,{class:"remain-tag",size:"small",type:"info"},{default:l(()=>[_("剩余座位："+w(U.remain)+"（总 "+w(U.total_seats)+"，用 "+w(U.used_seats)+"）｜可用邮箱："+w(U.available_mails),1)]),_:1})]),J("div",Aa,[e(m,{type:"danger",plain:"",size:"small",loading:Q.running,onClick:je},{default:l(()=>[...s[23]||(s[23]=[_("一键退订",-1)])]),_:1},8,["loading"]),e(m,{type:"primary",size:"small",onClick:Me},{default:l(()=>[...s[24]||(s[24]=[_("添加",-1)])]),_:1})])])]),default:l(()=>[e(f,{inline:!0,model:g,class:"filters",onSubmit:s[4]||(s[4]=bt(()=>{},["prevent"]))},{default:l(()=>[e(a,{label:"邮箱"},{default:l(()=>[e(b,{modelValue:g.email,"onUpdate:modelValue":s[0]||(s[0]=y=>g.email=y),placeholder:"精确匹配",clearable:""},null,8,["modelValue"])]),_:1}),e(a,{label:"分组ID"},{default:l(()=>[e(c,{modelValue:g.group_id,"onUpdate:modelValue":s[1]||(s[1]=y=>g.group_id=y),clearable:"",filterable:"","allow-create":"",placeholder:"全部",style:{width:"160px"}},{default:l(()=>[(h(!0),j(fe,null,he(Y.value,y=>(h(),R(t,{key:y,label:y,value:y},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(a,{label:"状态"},{default:l(()=>[e(c,{modelValue:g.status,"onUpdate:modelValue":s[2]||(s[2]=y=>g.status=y),clearable:"",placeholder:"全部",style:{width:"140px"},onChange:s[3]||(s[3]=y=>g.status=y===""||y==null?null:Number(y))},{default:l(()=>[e(t,{value:1,label:"正常"}),e(t,{value:2,label:"禁用"})]),_:1},8,["modelValue"])]),_:1}),e(a,null,{default:l(()=>[e(m,{type:"primary",onClick:Le},{default:l(()=>[...s[25]||(s[25]=[_("查询",-1)])]),_:1}),e(m,{onClick:ze},{default:l(()=>[...s[26]||(s[26]=[_("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),ve((h(),R(ae,{data:D.value,size:"small",border:!0},{default:l(()=>[e(p,{prop:"id",label:"ID",width:"80"}),e(p,{prop:"group_id",label:"分组ID",width:"110"}),e(p,{prop:"account_id",label:"Account ID",width:"140"}),e(p,{prop:"email",label:"邮箱"}),e(p,{prop:"seats",label:"席位",width:"80"}),e(p,{prop:"used_seats",label:"已使用席位",width:"110"}),e(p,{prop:"status",label:"状态",width:"80"},{default:l(({row:y})=>[e(u,{type:Number(y.status)===1?"success":"danger"},{default:l(()=>[_(w(Number(y.status)===1?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"expire_at",label:"过期时间",width:"180"},{default:l(({row:y})=>[_(w(me(y.expire_at)),1)]),_:1}),e(p,{prop:"created_at",label:"创建时间",width:"180"},{default:l(({row:y})=>[_(w(me(y.created_at)),1)]),_:1}),e(p,{prop:"updated_at",label:"更新时间",width:"180"},{default:l(({row:y})=>[_(w(me(y.updated_at)),1)]),_:1}),e(p,{label:"操作",width:"200",fixed:"right"},{default:l(({row:y})=>[e(m,{link:"",size:"small",onClick:Ke=>Be(y)},{default:l(()=>[...s[27]||(s[27]=[_("编辑",-1)])]),_:1},8,["onClick"]),e(r,{direction:"vertical"}),e(m,{link:"",size:"small",onClick:Ke=>ce(y),disabled:!y.rt},{default:l(()=>[...s[28]||(s[28]=[_("刷新",-1)])]),_:1},8,["onClick","disabled"]),e(r,{direction:"vertical"}),e(m,{link:"",size:"small",onClick:Ke=>$e(y)},{default:l(()=>[...s[29]||(s[29]=[_("详情",-1)])]),_:1},8,["onClick"]),e(r,{direction:"vertical"}),e(T,{trigger:"click",onCommand:Ke=>n(Ke,y)},{dropdown:l(()=>[e(L,null,{default:l(()=>[e(I,{command:"status"},{default:l(()=>[...s[31]||(s[31]=[_("查询订阅状态",-1)])]),_:1}),e(I,{command:"cancel",disabled:!y.id},{default:l(()=>[...s[32]||(s[32]=[_("取消订阅",-1)])]),_:1},8,["disabled"]),e(I,{command:"delete",divided:"",disabled:!y.id,style:{color:"var(--el-color-danger)"}},{default:l(()=>[...s[33]||(s[33]=[_("删除",-1)])]),_:1},8,["disabled"])]),_:2},1024)]),default:l(()=>[e(m,{link:"",size:"small"},{default:l(()=>[...s[30]||(s[30]=[_("更多",-1)])]),_:1})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data"])),[[He,W.value]]),J("div",Ra,[e(we,{layout:"total, sizes, prev, pager, next, jumper","page-sizes":[10,20,50,100],"current-page":k.page,"page-size":k.pageSize,total:k.total,onCurrentChange:de,onSizeChange:Ue},null,8,["current-page","page-size","total"])])]),_:1}),e(Ve,{modelValue:B.visible,"onUpdate:modelValue":s[13]||(s[13]=y=>B.visible=y),title:B.isEdit?"编辑团队":"添加团队",width:"560px"},{footer:l(()=>[e(m,{onClick:s[12]||(s[12]=y=>B.visible=!1)},{default:l(()=>[...s[34]||(s[34]=[_("取消",-1)])]),_:1}),e(m,{type:"primary",loading:M.value,onClick:qe},{default:l(()=>[...s[35]||(s[35]=[_("保存",-1)])]),_:1},8,["loading"])]),default:l(()=>[e(f,{model:N,"label-width":"120px"},{default:l(()=>[B.isEdit?(h(),R(a,{key:0,label:"ID"},{default:l(()=>[e(b,{modelValue:N.id,"onUpdate:modelValue":s[5]||(s[5]=y=>N.id=y),modelModifiers:{number:!0},disabled:""},null,8,["modelValue"])]),_:1})):G("",!0),e(a,{label:"邮箱"},{default:l(()=>[e(b,{modelValue:N.email,"onUpdate:modelValue":s[6]||(s[6]=y=>N.email=y),disabled:B.isEdit},null,8,["modelValue","disabled"])]),_:1}),B.isEdit?G("",!0):(h(),R(a,{key:1,label:"密码"},{default:l(()=>[e(b,{modelValue:N.password,"onUpdate:modelValue":s[7]||(s[7]=y=>N.password=y),"show-password":""},null,8,["modelValue"])]),_:1})),e(a,{label:"席位"},{default:l(()=>[e(Ge,{modelValue:N.seats,"onUpdate:modelValue":s[8]||(s[8]=y=>N.seats=y),min:1},null,8,["modelValue"])]),_:1}),e(a,{label:"状态"},{default:l(()=>[e(c,{modelValue:N.status,"onUpdate:modelValue":s[9]||(s[9]=y=>N.status=y)},{default:l(()=>[e(t,{value:1,label:"正常"}),e(t,{value:2,label:"禁用"})]),_:1},8,["modelValue"])]),_:1}),e(a,{label:"RT"},{default:l(()=>[e(b,{modelValue:N.rt,"onUpdate:modelValue":s[10]||(s[10]=y=>N.rt=y)},null,8,["modelValue"])]),_:1}),e(a,{label:"分组ID"},{default:l(()=>[e(c,{modelValue:N.group_id,"onUpdate:modelValue":s[11]||(s[11]=y=>N.group_id=y),clearable:"",filterable:"","allow-create":"",placeholder:"可选，可留空",style:{width:"220px"}},{default:l(()=>[(h(!0),j(fe,null,he(Y.value,y=>(h(),R(t,{key:y,label:y,value:y},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(Ve,{modelValue:x.visible,"onUpdate:modelValue":s[16]||(s[16]=y=>x.visible=y),title:`团队详情 #${x.teamId||""}`,width:"820px",onClosed:ne},{footer:l(()=>[e(m,{onClick:s[15]||(s[15]=y=>x.visible=!1)},{default:l(()=>[...s[40]||(s[40]=[_("关闭",-1)])]),_:1})]),default:l(()=>[ve((h(),j("div",La,[e(We,{modelValue:x.activeTab,"onUpdate:modelValue":s[14]||(s[14]=y=>x.activeTab=y),class:"details-tabs","tab-position":"top"},{default:l(()=>[e(Ae,{label:"用户列表",name:"users"},{default:l(()=>[e(ae,{data:x.usersView,size:"small",border:!0},{default:l(()=>[e(p,{prop:"email",label:"邮箱"}),e(p,{prop:"role",label:"角色",width:"120"}),e(p,{prop:"created_time",label:"创建时间",width:"180"},{default:l(({row:y})=>[_(w(me(y.created_time)),1)]),_:1}),e(p,{label:"操作",width:"120"},{default:l(({row:y})=>[e(Ee,{title:"确定要移除该用户吗？",onConfirm:()=>Fe(y)},{reference:l(()=>[e(m,{link:"",size:"small",type:"danger",disabled:String(y.role)==="account-owner"},{default:l(()=>[...s[36]||(s[36]=[_("移除",-1)])]),_:1},8,["disabled"])]),_:2},1032,["onConfirm"])]),_:1}),e(p,{label:"状态",width:"120"},{default:l(({row:y})=>[String(y.role)==="account-owner"?(h(),R(u,{key:0,type:"info"},{default:l(()=>[...s[37]||(s[37]=[_("owner",-1)])]),_:1})):(h(),R(u,{key:1,type:y.isWhitelist?"success":"warning"},{default:l(()=>[_(w(y.isWhitelist?"白名单":"未知"),1)]),_:2},1032,["type"]))]),_:1})]),_:1},8,["data"])]),_:1}),e(Ae,{label:"Pending 列表",name:"pending"},{default:l(()=>[e(ae,{data:x.pendingView,size:"small",border:!0},{default:l(()=>[e(p,{prop:"email",label:"邮箱"}),e(p,{prop:"role",label:"角色",width:"120"}),e(p,{prop:"created_time",label:"创建时间",width:"180"},{default:l(({row:y})=>[_(w(me(y.created_time)),1)]),_:1}),e(p,{label:"操作",width:"120"},{default:l(({row:y})=>[e(Ee,{title:"确定要移除该邀请吗？",onConfirm:()=>Je(y)},{reference:l(()=>[e(m,{link:"",size:"small",type:"danger",disabled:String(y.role)==="account-owner"},{default:l(()=>[...s[38]||(s[38]=[_("移除",-1)])]),_:1},8,["disabled"])]),_:2},1032,["onConfirm"])]),_:1}),e(p,{label:"状态",width:"120"},{default:l(({row:y})=>[String(y.role)==="account-owner"?(h(),R(u,{key:0,type:"info"},{default:l(()=>[...s[39]||(s[39]=[_("owner",-1)])]),_:1})):(h(),R(u,{key:1,type:y.isWhitelist?"success":"warning"},{default:l(()=>[_(w(y.isWhitelist?"白名单":"未知"),1)]),_:2},1032,["type"]))]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["modelValue"])])),[[He,x.loading]])]),_:1},8,["modelValue","title"]),e(Ve,{modelValue:Q.visible,"onUpdate:modelValue":s[18]||(s[18]=y=>Q.visible=y),title:"一键退订结果",width:"660px","close-on-click-modal":!Q.running,"close-on-press-escape":!Q.running,"show-close":!Q.running},{footer:l(()=>[e(m,{onClick:s[17]||(s[17]=y=>Q.visible=!1),disabled:Q.running},{default:l(()=>[...s[41]||(s[41]=[_("关闭",-1)])]),_:1},8,["disabled"])]),default:l(()=>[ve((h(),j("div",Ma,[e(ae,{data:Q.logs,size:"small",border:!0},{default:l(()=>[e(p,{prop:"id",label:"ID",width:"100"}),e(p,{prop:"email",label:"邮箱"}),e(p,{label:"状态",width:"140"},{default:l(({row:y})=>[e(u,{size:"small",type:d(y.status)},{default:l(()=>[_(w(De(y.status)),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"message",label:"结果"})]),_:1},8,["data"])])),[[He,Q.running]])]),_:1},8,["modelValue","close-on-click-modal","close-on-press-escape","show-close"]),e(Ve,{modelValue:P.visible,"onUpdate:modelValue":s[21]||(s[21]=y=>P.visible=y),title:`订阅状态 #${P.teamId||""}`,width:"720px"},{footer:l(()=>[e(m,{onClick:s[20]||(s[20]=y=>P.visible=!1)},{default:l(()=>[...s[43]||(s[43]=[_("关闭",-1)])]),_:1})]),default:l(()=>[ve((h(),j("div",Ba,[P.loading?G("",!0):(h(),j(fe,{key:0},[e(o,{column:2,border:"",size:"small"},{default:l(()=>[e(le,{label:"计划类型"},{default:l(()=>[e(u,{size:"small"},{default:l(()=>[_(w(A(P.data?.plan_type)),1)]),_:1})]),_:1}),e(le,{label:"计费周期"},{default:l(()=>[_(w(K(P.data?.billing_period)),1)]),_:1}),e(le,{label:"席位"},{default:l(()=>[_(w(Number(P.data?.seats_in_use||0))+" / "+w(Number(P.data?.seats_entitled||0)),1)]),_:1}),e(le,{label:"币种"},{default:l(()=>[_(w(P.data?.billing_currency||"-"),1)]),_:1}),e(le,{label:"生效时间"},{default:l(()=>[_(w(me(P.data?.active_start||"")),1)]),_:1}),e(le,{label:"到期时间"},{default:l(()=>[_(w(me(P.data?.active_until||"")),1)]),_:1}),e(le,{label:"自动续订"},{default:l(()=>[e(u,{size:"small",type:P.data?.will_renew?"success":"info"},{default:l(()=>[_(w(P.data?.will_renew?"是":"否"),1)]),_:1},8,["type"])]),_:1}),e(le,{label:"是否欠费"},{default:l(()=>[e(u,{size:"small",type:P.data?.is_delinquent?"danger":"success"},{default:l(()=>[_(w(P.data?.is_delinquent?"是":"否"),1)]),_:1},8,["type"])]),_:1}),e(le,{label:"非营利折扣"},{default:l(()=>[e(u,{size:"small",type:P.data?.non_profit_org_discount_applied?"success":"info"},{default:l(()=>[_(w(P.data?.non_profit_org_discount_applied?"是":"否"),1)]),_:1},8,["type"])]),_:1}),e(le,{label:"订阅ID"},{default:l(()=>[_(w(P.data?.id||"-"),1)]),_:1})]),_:1}),P.data?.is_delinquent?(h(),j("div",qa,[e(se,{type:"warning",closable:!1,"show-icon":""},{title:l(()=>[s[42]||(s[42]=_(" 账户存在欠费 ",-1)),P.data?.grace_period_end_timestamp?(h(),j("span",Fa,"，宽限结束："+w(me(P.data?.grace_period_end_timestamp)),1)):G("",!0)]),_:1})])):G("",!0),J("div",Ja,[e(m,{text:"",type:"primary",onClick:s[19]||(s[19]=y=>P.showRaw=!P.showRaw)},{default:l(()=>[_(w(P.showRaw?"隐藏原始JSON":"查看原始JSON"),1)]),_:1})]),ve(J("div",Qa,[J("pre",Ga,w(O(P.data)),1)],512),[[Ft,P.showRaw]])],64))])),[[He,P.loading]])]),_:1},8,["modelValue","title"])])}}},Ya=Xe(Wa,[["__scopeId","data-v-724ee4a0"]]),zt=Object.freeze(Object.defineProperty({__proto__:null,default:Ya},Symbol.toStringTag,{value:"Module"})),Ha=[{path:"/",component:It,meta:{menuType:1},children:[{path:"/team/maker",name:"team-owner-maker",component:()=>Re(()=>Promise.resolve().then(()=>Tt),void 0),meta:{title:"团队母号",icon:"el-icon-user",menuType:2,keepAlive:!1}},{path:"/team/owner",name:"team-owner",component:()=>Re(()=>Promise.resolve().then(()=>zt),void 0),meta:{title:"团队管理",icon:"el-icon-user",menuType:2,keepAlive:!1}},{path:"/team/member",name:"team-member",component:()=>Re(()=>Promise.resolve().then(()=>Ct),void 0),meta:{title:"成员管理",icon:"el-icon-user",menuType:2,keepAlive:!1}}]}],Ka={test:"default_test"},Za={namespaced:!0,state:Ka,mutations:{TEST:(ie,W)=>{ie.test=W}},actions:{toggleSideBar({commit:ie}){ie("TEST","abc")}}},Xa={routes:Ha,storeModules:{admin:Za}},el={VITE_BASE_API:"/_api"};xt({GetRTAT:lt(()=>Re(()=>import("./GetRTAT-CBiVSwvb.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48])))});xt({RedeemCode:lt(()=>Re(()=>import("./RedeemCode-Ddx6D8Aa.js"),__vite__mapDeps([49,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,50])))});Ut("dashboard",lt(()=>Re(()=>Promise.resolve().then(()=>Nt),void 0)));Ot(Object.assign({"./views/dashboard/index.vue":Nt,"./views/team/Maker.vue":Tt,"./views/team/Member.vue":Ct,"./views/team/Owner.vue":zt}));const tl=el,al={settings:{formMutex:!1,title:"XgoAdmin",showPageJsonSchema:!1,logo:"https://dow.chatbee.cc/chatgpt.jpeg",defaultAvatar:"https://dow.chatbee.cc/chatgpt.jpeg",captcha:!1},plugins:[Xa],axios:{baseURL:(window.BASE_URL||tl.VITE_BASE_API)+""},form:{vsPath:location.pathname+"assets/monaco-editor/vs"}};Pt(al);export{Xe as _};
